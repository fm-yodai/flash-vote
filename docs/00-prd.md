# Flash Vote PRD

## 1. 概要
イベント/会議/勉強会等で、ホストがその場で質問を出し、参加者（ゲスト）がQRから参加して即時投票できるWebアプリ。

## 2. ゴール
- 登録なしで参加できる（ゲストの摩擦を最小化）
- ホストが「作成→公開→ライブ進行→結果表示」をスムーズに回せる
- 結果が"盛り上がる"見た目で即時反映される（リアルタイム）
- 自由記述はAIでクラスタリングし、見える化できる

## 3. 非ゴール
- 厳密な本人認証/不正投票の完全防止（一定の抑止に留める）
- ユーザーアカウント/ログイン機構
- 高度な分析ダッシュボード（MVPでは不要）

## 4. 主要ユーザー
- ホストユーザー：回（room）を作り、質問を用意し、ライブ操作する
- ゲストユーザー：QRから参加し、質問に回答する（登録なし）

## 5. 用語
- 回（Room）：1つの投票セッション。公開/非公開、ライブ進行が可能。
- 質問（Question）：回に紐づく質問。選択式または自由記述。
- 選択肢（Option）：選択式質問に紐づく候補。
- 参加者（Participant）：登録なしゲストを識別する匿名ID（cookie/localStorage）。
- ホストトークン：回作成時に発行される管理用シークレット（管理URLに含む）。

## 6. MVP機能要件（固定）
### 6.1 ホスト
- 回を作成できる
- 回の管理URL（シークレット付き）でのみ編集・操作できる（ユーザー登録なしの代替）
- 回に複数質問と選択肢を作成/編集/削除できる
- 回を公開/非公開できる
- 公開URL（ゲスト参加URL）とQRコードを発行できる
- ゲストの数（参加中/累計）を閲覧できる
- ライブ操作：受付開始、受付終了、結果表示、次へ、終了

### 6.2 ゲスト
- QR（公開URL）から回に参加できる
- 質問に回答できる（選択式 / 自由記述）
- ネットワーク切断/再接続しても「今の質問」に復帰できる

### 6.3 結果表示
- 選択式：票数、割合、回答者数を表示。モダンなグラフ（横棒を標準）
- 自由記述：AIクラスタリングによる可視化（label/count/examples）

### 6.4 AI（上乗せ機能）
- ホストが回の目的（自然言語）を入力すると、質問+選択肢案を受け取れる
- 質問ごとに承認/棄却できる
- 承認後の質問は編集/削除できる
- AI提案はproposalVersionで管理し、承認対象がぶれないようにする

## 7. 不正/一意性（固定）
- 参加者識別：participantIdをcookie/localStorageに保持（UUID）
- 1端末につき、同一質問への回答は1回（participantId + questionId でユニーク制約）
- レート制限：IP/room単位で実施（完全防止ではなく抑止）

## 8. 非機能要件
- イベント現場でも動く：初回ロードが速い、操作が単純
- スケール目安：同時参加 50〜300 程度（将来拡張可）
- ログ：ホスト操作、公開切替、エラーを追える

## 9. ステージ計画（受入基準）
### Stage 0: 環境土台
- pnpm workspaceでweb/api/sharedが起動
- DockerでPostgres起動、.env.exampleあり

### Stage 1: 状態モデル+DB+型
- DB migrationが通る
- ルーム作成APIが動き、hostSecretはハッシュ保存

### Stage 2: ホスト作成/編集/公開/QR
- 管理URLのみ編集可能
- 公開URL & QR発行
- 質問・選択肢CRUD

### Stage 3: ゲスト参加/回答/再接続
- QR→参加→回答
- 同一質問に二重回答できない（DB側で保証）

### Stage 4: ライブ操作+SSE
- ホスト操作でゲストが即時追随（SSE）
- 受付開始/終了/結果/次へ/終了

### Stage 5: グラフ
- 選択式が横棒で見やすい
- 母数・票数・割合が出る

### Stage 6: AI提案/クラスタ
- proposalVersion管理
- 承認/棄却/編集
- 自由記述クラスタ可視化（ホストが最低限調整可）

### Stage 7: ハードニング
- rate limit、監査ログ、運用Runbook整備
